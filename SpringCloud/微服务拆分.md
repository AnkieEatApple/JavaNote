## 微服务拆分.md
1. 既然是微服务，就需要对原有的一套服务进行拆分
2. 架构走向<br/>![WeChatc55620b2cf32729abfa6fb0c76695cb4.png](https://i.loli.net/2019/06/27/5d148d6f9a3b324681.png)


### 一、如何拆分
1. 先明白起点和终点
	* 起点
		* 即有的架构的形态
	* 终点
		* 好的架构不是设计出来的，而是进化而来的
		* 一直在演进ing
2. **需要考虑哪些因素与坚持的原则**

#### 1.1 拆分需要的背景
1. 如果单位的系统架构已经是SOA服务化的话，就不需要了
2. 微服务和SOA之间只差了一个ESB，ESB就是企业服务总线，[SOA、微服务、ESB之间的关系](https://mp.weixin.qq.com/s/fCsVP5pO2vJX3DlMb-RdrA)
3. 如果当前的服务端的代码是异构的，那么Java部分的代码占据了多少，非Java代码的部分有没有服务注册的组件，是接着使用这写代码还是保留，如何以最小的代价切换过去
4. 优先考虑是否需要微服务
	1. 系统中包含很多很多强事物场景的，强事物比如订单秒杀，直播刷礼物等
	2. 业务相对稳定，迭代周期长
	3. 访问压力不大，可用性要求不高，比如中小型企业的OA系统之类的

#### 1.2 康威定律
1. 梅尔康威提出来的一个文章，然后<人月神话>中提出来了
2. 内容：**任何组织设计一套系统(广义概念上的系统)时，所交付的设计方案在结构上都与该组织的沟通结构保持一致。**
3. **一句话概括: 沟通的问题会影响系统的设计**
4. 这种就是微服务由小团队来操作，然后团队内部细粒度的迭代，业务架构和整体团队的组织架构相匹配，大系统拆成小服务，团队也会随之变化，微服务的最后的问题又归结到了团队的管理问题

#### 1.3 微服务和团队结构
1. 微服务的特点
	* 一系列微笑服务的共同组成
	* 单独部署，跑在自己的进程里
	* 每个服务为独立的业务开发
	* 分布式的管理

2. 传统开发和微服务，有点类似于敏捷开发<br/>![WeChat9000ed11ed9be3a35d9b4644a4a1f008.png](https://i.loli.net/2019/06/27/5d149a583c63b34092.png)

#### 1.4 拆分的方式
1. 这个要根据业务的增长的速度和团队的技术栈进行考虑
2. 如果业务增长不是很快，且技术栈不充裕，可以按照技术栈拆分
3. 如果业务增长迅速，技术栈人员充裕，最好按照业务进行拆分，以点餐业务为例，最好按照订单业务、商品业务、支付业务等，这种业务的形式进行拆分，便于体量的增长和后期的维护

### 二、服务拆分的方法论
1. 扩展立方模型(Scale Cube)，出自可扩展的艺术一书，讲的是xyz三个轴的拓展
	* X轴，水平复制，通过副本扩展，将应用程序水平复制，通过负载均衡运行多个一样的副本的方式来实现应用程序的伸缩性，提高应用程序的容量和可用度
	* Z轴，按数据分区，简单点说就是每个服务器负责一个数据子集，每个服务器运行的代码是一样的
	* Y轴，功能结耦，针对功能行的外层伸缩，根据不同指责的模块分成不同的服务

2. 服务拆分的主要两个因素：功能、数据
3. 如何拆**功能**：
	1. **单一职责，松耦合、高内聚**，如果修改一个行为，多处服务都要动，那么就可能是当初划分模块不合理导致的。
	2. **关注点分离**，界限上下文--来自领域设计一书，也就是DDD，基本方法主要有
		* 按职责： 比如一些按业务领域的分离比较单一，比如订单、商品这类服务，还有网站的前端服务，app的服务接口，这些都可以划分为边缘服务。
		* 按通用型： 是指一些基础组件，与具体的业务无关的，也可以划分出来作为一个单独的服务，比如消息服务，用户服务，比如把公共组件拆分成相对独立的原子服务，形成相对独立的原子服务层
		* 按粒度级别：微服务的粒度不是越小越好，这个不是一个好把握的点
		
4. 服务和数据的关系
	* 先考虑业务功能，再考虑业务功能对应的数据
	* 无状态服务，如果一个数据需要被多个数据共享，才能完成一个请求，那么这个数据就可以称之为一个状态，进而依赖这个数据的状态的服务，称之为有状态服务，反之称之为无状态服务。
	* 尽量将有状态的服务改为无状态的服务，比如以前在本地创建的session缓存，到微服务架构中就应该把这些缓存迁移到分布式缓存中，让业务服务变成一个无状态的业务节点，在运行时，就可以做到运行时动态增删节点<br/>![WeChatba19b528c542d9a049fe2984ef6ca0fb.png](https://i.loli.net/2019/06/27/5d14a02052aa180385.png)

